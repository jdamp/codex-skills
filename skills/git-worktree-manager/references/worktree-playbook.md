# Git Worktree Playbook

## 1. Naming Conventions

Use predictable names so branches and directories remain discoverable:

- Branches:
  - `feature/<scope>-<topic>`
  - `fix/<scope>-<issue>`
  - `chore/<scope>-<task>`
- Worktree directories:
  - `<repo>-wt-<branch>` (default generated by `scripts/worktreectl`)
  - Example: `api-wt-feature-billing-refactor`

Keep branch names short but specific; avoid generic names like `temp` or `work`.

## 2. Recommended Lifecycle

1. Fetch updated refs:
   - `git fetch --all --prune`
2. Create worktree:
   - New branch from `main`: `scripts/worktreectl create feature/my-change`
   - Existing remote branch: `scripts/worktreectl create fix/my-bug --remote`
   - Create and open immediately: `scripts/worktreectl create feature/my-change --open`
3. Work normally inside the worktree:
   - Run tests, commit, push, open/update PR.
4. Start a parallel coding session:
   - Open later by branch/path: `scripts/worktreectl open feature/my-change`
   - Choose editor explicitly: `scripts/worktreectl open feature/my-change --editor code`
   - Preview the exact launch command: `scripts/worktreectl open feature/my-change --print-open-cmd`
   - Launch a second Codex CLI session in that worktree using the user's normal startup command.
5. Remove completed worktree:
   - `scripts/worktreectl remove feature/my-change`
6. Clean stale metadata:
   - `scripts/worktreectl prune`

## 3. Collaboration Patterns

Use separate worktrees for high-isolation tasks:

- Keep production hotfixes in a dedicated worktree while feature work continues.
- Keep dependency upgrades isolated from product feature branches.
- Keep PR review/repro worktrees separate from active implementation.

Pair worktrees with clear branch ownership and explicit cleanup at merge time.

## 4. Safety Checklist Before Removal

- Run `git -C <worktree-path> status -sb` and confirm clean state.
- Confirm required commits are pushed: `git -C <worktree-path> log --oneline origin/<branch>..HEAD`.
- Confirm no active tools are using the directory (test runner, editor task, dev server).
- Remove via `scripts/worktreectl remove <path-or-branch>`; use `--force` only when sure data is not needed.

## 5. Troubleshooting

### "Branch is already checked out"

Cause: The branch is active in another worktree.

Fix:

1. Run `scripts/worktreectl list`.
2. Locate the existing path for that branch.
3. Reuse that worktree or remove it first.

### "Path already exists"

Cause: Target directory already exists.

Fix:

1. Pass a different path using `--path`.
2. Remove the stale directory if no longer needed.

### Worktree metadata is stale after moving directories

Fix:

1. Run `scripts/worktreectl repair`.
2. Run `scripts/worktreectl prune`.
3. Re-check with `scripts/worktreectl list`.

### Base branch not found

Cause: `--base` does not exist locally or on `origin`.

Fix:

1. Run `git fetch --all --prune`.
2. Confirm branch name via `git branch -a`.
3. Retry with a valid base branch.
